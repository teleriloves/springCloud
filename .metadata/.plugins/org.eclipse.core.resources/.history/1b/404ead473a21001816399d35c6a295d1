package evolsoft.concesionario;

import org.springframework.beans.factory.annotation.Autowired;

import com.vaadin.server.VaadinRequest;
import com.vaadin.spring.annotation.SpringUI;
import com.vaadin.ui.Button;
import com.vaadin.ui.Grid;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.Label;
import com.vaadin.ui.Notification;
import com.vaadin.ui.TextField;
import com.vaadin.ui.UI;
import com.vaadin.ui.VerticalLayout;
import com.vaadin.ui.Button.ClickEvent;


import evolsoft.concesionario.dto.ClienteDTO;
import evolsoft.concesionario.dto.CocheDTO;
import evolsoft.concesionario.dto.VendedorDTO;
import evolsoft.concesionario.exception.NotFoundExcept;
import evolsoft.concesionario.service.ClienteService;
import evolsoft.concesionario.service.CocheService;
import evolsoft.concesionario.service.VendedorService;

@SpringUI
public class VaadinUI extends UI {

	private static final long serialVersionUID = 1L;

	@Autowired
	CocheService cocheService;
	@Autowired
	ClienteService clienteService;
	@Autowired
	VendedorService vendedorService;
	
	/*
	 * GRIDS
	 */
	Grid<CocheDTO> gridCoche = new Grid<>();
	Grid<ClienteDTO> gridCliente = new Grid<>();
	Grid<VendedorDTO> gridVendedor = new Grid<>();

	/*
	 * LAYOUTS
	 */
					//Coche
					VerticalLayout cocheElimination = new VerticalLayout();
					VerticalLayout cocheAddition = new VerticalLayout();
				HorizontalLayout cocheModification = new HorizontalLayout();
			VerticalLayout cocheContent = new VerticalLayout();
			
					//Cliente
					VerticalLayout clienteElimination = new VerticalLayout();
					VerticalLayout clienteAddition = new VerticalLayout();
				HorizontalLayout clienteModification = new HorizontalLayout();
			VerticalLayout clienteContent = new VerticalLayout();
				
					//Vendedor
					VerticalLayout vendedorElimination = new VerticalLayout();
					VerticalLayout vendedorAddition = new VerticalLayout();
				HorizontalLayout vendedorModofication = new HorizontalLayout();
			VerticalLayout vendedorContent = new VerticalLayout();
	
					//Data
		HorizontalLayout dataContent = new HorizontalLayout();
		
					//Web
	VerticalLayout webContent = new VerticalLayout();

	/*
	 * TEXTFIELDS
	 */
	private TextField cocheMatriculaTF = new TextField("Matricula");
	private TextField cocheMarcaTF = new TextField("Marca");
	private TextField cocheModeloTF = new TextField("Modelo");
	private TextField cocheMotorTF = new TextField("Motor");
	private TextField cocheBastidorTF = new TextField("Marca");
	private TextField cochePrecioTF = new TextField("Precio");
	private TextField cocheFechaVentaTF = new TextField("F. venta");
	
	
	/*
	 * BUTTONS 
	 */
		Button addIngredientButton = new Button("Añadir ingrediente", event -> {
			try {
				addCoche(event);
			} catch ( NotFoundExcept e) {
				Notification.show(e.getMessage());
			}
		});
	
	/*
	 * Init Method
	 */
	@Override
	protected void init(VaadinRequest request) {
		setDataGrids();
		setWebContent();
		setContent(webContent);
	}

	/*
	 * GRID SETTINGS
	 */
	private void setGridCoche() {
		gridCoche.addColumn(cocheDTO -> cocheDTO.getId()).setCaption("ID");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getMatricula()).setCaption("Matricula");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getMarca()).setCaption("Marca");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getModelo()).setCaption("Modelo");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getMotor()).setCaption("Motorización");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getNumBastidor()).setCaption("Num. Bastidor");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getPrecio()).setCaption("Marca");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getFechaVenta()).setCaption("Marca");

		listCoches();
	}
	
	private void setGridCliente() {
		
		gridCliente.addColumn(clienteDTO -> clienteDTO.getId()).setCaption("ID");
		gridCliente.addColumn(clienteDTO -> clienteDTO.getDni()).setCaption("DNI");
		gridCliente.addColumn(clienteDTO -> clienteDTO.getNombre()).setCaption("Nombre");
		gridCliente.addColumn(clienteDTO -> clienteDTO.getEmail()).setCaption("Email");
		gridCliente.addColumn(clienteDTO -> clienteDTO.getTlf()).setCaption("Telefono");
		
		listClientes();
	}
	
	private void setGridVendedor() {
		
		gridVendedor.addColumn(vendedorDTO -> vendedorDTO.getId()).setCaption("ID");
		gridVendedor.addColumn(vendedorDTO -> vendedorDTO.getDni()).setCaption("DNI");
		gridVendedor.addColumn(vendedorDTO -> vendedorDTO.getNombre()).setCaption("Nombre");
		gridVendedor.addColumn(vendedorDTO -> vendedorDTO.getEmail()).setCaption("Email");
		gridVendedor.addColumn(vendedorDTO -> vendedorDTO.getTlf()).setCaption("Telefono");
		
		listVendedores();
	}
	
	private void setDataGrids() {
		setGridCoche();
		setGridCliente();
		setGridVendedor();
	}

	
	/*
	 * DATA SETTINGS
	 */
	private void setCocheElimination() {
		
	}

	private void setCocheAddition() {
		cocheAddition.addComponent(new Label("Añadir coche"));
		cocheAddition.addComponent(cocheMatriculaTF);
		cocheAddition.addComponent(cocheMarcaTF);
		cocheAddition.addComponent(cocheModeloTF);
		cocheAddition.addComponent(cocheMotorTF);
		cocheAddition.addComponent(cocheBastidorTF);
		cocheAddition.addComponent(cochePrecioTF);
		cocheAddition.addComponent(cocheFechaVentaTF);

	}
	
	private void setCocheModification() {
		setCocheAddition();
		setCocheElimination();
		cocheModification.addComponent(cocheAddition);
		cocheModification.addComponent(cocheElimination);
		
	}
	
	private void setCocheContent() {
		setCocheModification();
		cocheContent.addComponent(gridCoche);
		cocheContent.addComponent(cocheModification);
	}
	
	private void setClienteContent() {
		clienteContent.addComponent(gridCliente);
	}
	
	private void setVendedorContent() {
		vendedorContent.addComponent(gridVendedor);
	}
	
	private void setDataContent() {
		setCocheContent();
		setClienteContent();
		setVendedorContent();
		
		dataContent.addComponent(cocheContent);
		dataContent.addComponent(clienteContent);
		dataContent.addComponent(vendedorContent);
	}
		
	private void listCoches() {	
		gridCoche.setItems(cocheService.findAll(0, 30));
	}

	private void listClientes() {
		gridCliente.setItems(clienteService.findAll(0, 30));
	}
	
	private void listVendedores() {
		gridVendedor.setItems(vendedorService.findAll(0, 30));	
	}

	/*
	 * MAIN VIEW SETTINGS
	 */
	private void setWebContent() {
		setDataContent();
		webContent.addComponent(new Label("Concesionario"));
		webContent.addComponent(dataContent);
		
	}
	
	/*
	 * ADDITIONS / ELIMINATIONS
	 */
	private void addCoche(ClickEvent clickEvent) throws NotFoundExcept {
		CocheDTO cocheDTO = new CocheDTO();
		cocheDTO.setMatricula(cocheMatriculaTF.getValue());
		cocheDTO.setMarca(cocheMarcaTF.getValue());
		cocheDTO.setModelo(cocheModeloTF.getValue());
		cocheDTO.setMotor(cocheMotorTF.getValue());
		cocheDTO.setNumBastidor((Integer) cocheBastidorTF.getData());
		cocheDTO.setPrecio((Double) cochePrecioTF.getData());
		cocheDTO.setFechaVenta(cocheFechaVentaTF.getValue());
		cocheService.create(cocheDTO);
		this.refresh(clickEvent);
	}
	
	public void refresh(ClickEvent clickEvent) throws NotFoundExcept {
		listCoches();
		listClientes();
		listVendedores();
	}
	
}
