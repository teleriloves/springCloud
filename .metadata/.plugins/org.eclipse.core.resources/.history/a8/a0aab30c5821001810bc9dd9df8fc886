package evolsoft.concesionario;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.crossstore.ChangeSetPersister.NotFoundException;

import com.vaadin.server.VaadinRequest;
import com.vaadin.spring.annotation.SpringUI;
import com.vaadin.ui.Button;
import com.vaadin.ui.Grid;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.Label;
import com.vaadin.ui.Notification;
import com.vaadin.ui.TextField;
import com.vaadin.ui.UI;
import com.vaadin.ui.VerticalLayout;
import com.vaadin.ui.Button.ClickEvent;


import evolsoft.concesionario.dto.ClienteDTO;
import evolsoft.concesionario.dto.CocheDTO;
import evolsoft.concesionario.dto.VendedorDTO;
import evolsoft.concesionario.exception.NotFoundExcept;
import evolsoft.concesionario.service.ClienteService;
import evolsoft.concesionario.service.CocheService;
import evolsoft.concesionario.service.VendedorService;

@SpringUI
public class VaadinUI extends UI {

	private static final long serialVersionUID = 1L;

	@Autowired
	CocheService cocheService;
	@Autowired
	ClienteService clienteService;
	@Autowired
	VendedorService vendedorService;
	
	/*
	 * GRIDS
	 */
	Grid<CocheDTO> gridCoche = new Grid<>();
	Grid<ClienteDTO> gridCliente = new Grid<>();
	Grid<VendedorDTO> gridVendedor = new Grid<>();

	/*
	 * LAYOUTS
	 */
					//Coche
					VerticalLayout cocheElimination = new VerticalLayout();
						VerticalLayout cocheAddition = new VerticalLayout();
						VerticalLayout cocheEdition = new VerticalLayout();
				HorizontalLayout cocheModification = new HorizontalLayout();
			VerticalLayout cocheContent = new VerticalLayout();
			
					//Cliente
					VerticalLayout clienteElimination = new VerticalLayout();
					VerticalLayout clienteAddition = new VerticalLayout();
				HorizontalLayout clienteModification = new HorizontalLayout();
			VerticalLayout clienteContent = new VerticalLayout();
				
					//Vendedor
					VerticalLayout vendedorElimination = new VerticalLayout();
					VerticalLayout vendedorAddition = new VerticalLayout();
				HorizontalLayout vendedorModofication = new HorizontalLayout();
			VerticalLayout vendedorContent = new VerticalLayout();
	
					//Data
		HorizontalLayout dataContent = new HorizontalLayout();
		
					//Web
	VerticalLayout webContent = new VerticalLayout();

	/*
	 * TEXTFIELDS
	 */
	private TextField cocheAddMatriculaTF = new TextField("Matricula");
	private TextField cocheAddMarcaTF = new TextField("Marca");
	private TextField cocheAddModeloTF = new TextField("Modelo");
	private TextField cocheAddMotorTF = new TextField("Motor");
	private TextField cocheAddBastidorTF = new TextField("Marca");
	private TextField cocheAddPrecioTF = new TextField("Precio");
	private TextField cocheAddFechaVentaTF = new TextField("F. venta");
	
	private TextField cocheEditIdTF = new TextField("Id");
	private TextField cocheEditMatriculaTF = new TextField("Matricula");
	private TextField cocheEditMarcaTF = new TextField("Marca");
	private TextField cocheEditModeloTF = new TextField("Modelo");
	private TextField cocheEditMotorTF = new TextField("Motor");
	private TextField cocheEditBastidorTF = new TextField("Marca");
	private TextField cocheEditPrecioTF = new TextField("Precio");
	private TextField cocheEditFechaVentaTF = new TextField("F. venta");
	
	/*
	 * BUTTONS 
	 */
		Button cocheAddButton = new Button("A침adir Coche", event -> {
			try {
				addCoche(event);
			} catch ( NotFoundExcept e) {
				Notification.show(e.getMessage());
			}
		});
		
		Button cocheEditButton = new Button("A침adir Coche", event -> {
			try {
				editCoche(event);
			} catch ( NotFoundExcept e) {
				Notification.show(e.getMessage());
			}
		});
		

	/*
	 * Init Method
	 */
	@Override
	protected void init(VaadinRequest request) {
		setDataGrids();
		setWebContent();
		setContent(webContent);
	}

	
	/*
	 * GRID SETTINGS
	 */
	private void setGridCoche() {
		gridCoche.addColumn(cocheDTO -> cocheDTO.getId()).setCaption("ID");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getMatricula()).setCaption("Matricula");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getMarca()).setCaption("Marca");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getModelo()).setCaption("Modelo");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getMotor()).setCaption("Motorizaci칩n");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getNumBastidor()).setCaption("Num. Bastidor");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getPrecio()).setCaption("Marca");
		gridCoche.addColumn(cocheDTO -> cocheDTO.getFechaVenta()).setCaption("Marca");

		listCoches();
	}
	
	private void setGridCliente() {
		
		gridCliente.addColumn(clienteDTO -> clienteDTO.getId()).setCaption("ID");
		gridCliente.addColumn(clienteDTO -> clienteDTO.getDni()).setCaption("DNI");
		gridCliente.addColumn(clienteDTO -> clienteDTO.getNombre()).setCaption("Nombre");
		gridCliente.addColumn(clienteDTO -> clienteDTO.getEmail()).setCaption("Email");
		gridCliente.addColumn(clienteDTO -> clienteDTO.getTlf()).setCaption("Telefono");
		
		listClientes();
	}
	
	private void setGridVendedor() {
		
		gridVendedor.addColumn(vendedorDTO -> vendedorDTO.getId()).setCaption("ID");
		gridVendedor.addColumn(vendedorDTO -> vendedorDTO.getDni()).setCaption("DNI");
		gridVendedor.addColumn(vendedorDTO -> vendedorDTO.getNombre()).setCaption("Nombre");
		gridVendedor.addColumn(vendedorDTO -> vendedorDTO.getEmail()).setCaption("Email");
		gridVendedor.addColumn(vendedorDTO -> vendedorDTO.getTlf()).setCaption("Telefono");
		
		listVendedores();
	}
	
	private void setDataGrids() {
		setGridCoche();
		setGridCliente();
		setGridVendedor();
	}

	
	/*
	 * DATA SETTINGS
	 */
	private void setCocheElimination() {
		
	}

	private void setCocheAddition() {
		cocheAddition.addComponent(new Label("A침adir coche"));
		cocheAddition.addComponent(cocheAddMatriculaTF);
		cocheAddition.addComponent(cocheAddMarcaTF);
		cocheAddition.addComponent(cocheAddModeloTF);
		cocheAddition.addComponent(cocheAddMotorTF);
		cocheAddition.addComponent(cocheAddBastidorTF);
		cocheAddition.addComponent(cocheAddPrecioTF);
		cocheAddition.addComponent(cocheAddFechaVentaTF);
		cocheAddition.addComponent(cocheAddButton);
	}
	
	private void setCocheEdition() {
		cocheAddition.addComponent(new Label("Editar coche"));
		cocheAddition.addComponent(cocheEditIdTF);
		cocheAddition.addComponent(cocheEditMatriculaTF);
		cocheAddition.addComponent(cocheEditMarcaTF);
		cocheAddition.addComponent(cocheEditModeloTF);
		cocheAddition.addComponent(cocheEditMotorTF);
		cocheAddition.addComponent(cocheEditBastidorTF);
		cocheAddition.addComponent(cocheEditPrecioTF);
		cocheAddition.addComponent(cocheEditFechaVentaTF);
		cocheAddition.addComponent(cocheEditButton);
	}
	
	private void setCocheModification() {
		setCocheAddition();
		setCocheEdition();
		cocheModification.addComponent(cocheAddition);
		cocheModification.addComponent(cocheEdition);
		
		
	}
	
	private void setCocheContent() {
		setCocheModification();
		setCocheElimination();
		cocheContent.addComponent(gridCoche);
		cocheContent.addComponent(cocheModification);
		cocheModification.addComponent(cocheElimination);
	}
	
	private void setClienteContent() {
		clienteContent.addComponent(gridCliente);
	}
	
	private void setVendedorContent() {
		vendedorContent.addComponent(gridVendedor);
	}
	
	private void setDataContent() {
		setCocheContent();
		setClienteContent();
		setVendedorContent();
		
		dataContent.addComponent(cocheContent);
		dataContent.addComponent(clienteContent);
		dataContent.addComponent(vendedorContent);
	}
		
	private void listCoches() {	
		gridCoche.setItems(cocheService.findAll(0, 30));
	}

	private void listClientes() {
		gridCliente.setItems(clienteService.findAll(0, 30));
	}
	
	private void listVendedores() {
		gridVendedor.setItems(vendedorService.findAll(0, 30));	
	}

	/*
	 * MAIN VIEW SETTINGS
	 */
	private void setWebContent() {
		setDataContent();
		webContent.addComponent(new Label("Concesionario"));
		webContent.addComponent(dataContent);
		
	}
	
	/*
	 * ADDITIONS / ELIMINATIONS
	 */
	private void addCoche(ClickEvent clickEvent) throws NotFoundExcept {
		CocheDTO cocheDTO = new CocheDTO();
		cocheDTO.setMatricula(cocheAddMatriculaTF.getValue());
		cocheDTO.setMarca(cocheAddMarcaTF.getValue());
		cocheDTO.setModelo(cocheAddModeloTF.getValue());
		cocheDTO.setMotor(cocheAddMotorTF.getValue());
		cocheDTO.setNumBastidor((Integer.parseInt(cocheAddBastidorTF.getValue())));
		cocheDTO.setPrecio(Double.parseDouble(cocheAddPrecioTF.getValue()));
		cocheDTO.setFechaVenta(cocheAddFechaVentaTF.getValue());
		cocheService.create(cocheDTO);
		this.refresh(clickEvent);
	}
	
	private void editCoche(ClickEvent event) throws NotFoundExcept {
		CocheDTO cocheDTO = cocheService.findById(Integer.parseInt(cocheEditIdTF.getValue())); 
		if(!cocheEditMarcaTF.isEmpty()) cocheDTO.setMarca(cocheEditMarcaTF.getValue());
		if(!cocheEditModeloTF.isEmpty()) cocheDTO.setModelo(cocheEditModeloTF.getValue());
		if(!cocheEditMotorTF.isEmpty()) cocheDTO.setMotor(cocheAddMotorTF.getValue());
		if(!cocheEditBastidorTF.isEmpty()) cocheDTO.setMotor(cocheEditBastidorTF.getValue());
		if(!cocheEditPrecioTF.isEmpty()) cocheDTO.setPrecio(Double.parseDouble(cocheEditPrecioTF.getValue()));
		if(!cocheEditFechaVentaTF.isEmpty()) cocheDTO.setFechaVenta(cocheEditFechaVentaTF.getValue());
		cocheService.update(cocheDTO.getId(), cocheDTO);
		this.refresh(event);
	
		
	}

	
	public void refresh(ClickEvent clickEvent) throws NotFoundExcept {
		listCoches();
		listClientes();
		listVendedores();
	}
	
}
